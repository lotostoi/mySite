ИНСТРУКЦИЯ ПО РАЗВЕРТЫВАНИЮ САЙТА
=====================================

СЕРВЕР НА SELECTEL
------------------
Конфигурация: 2 vCPU, 2 GB RAM, 20 GB SSD
ОС: Ubuntu 22.04
Цена: 590 руб/мес


ЛОКАЛЬНЫЙ ЗАПУСК
----------------
composer install
cp .env.example .env
php artisan key:generate
php artisan migrate
php artisan serve

Откройте: http://localhost:8000


РАЗВЕРТЫВАНИЕ НА СЕРВЕРЕ
-------------------------

ШАГ 1: Подключение к серверу
ssh root@ваш_ip


ШАГ 2: Обновление системы
apt update && apt upgrade -y


ШАГ 3: Установка Nginx
apt install nginx -y


ШАГ 4: Установка PHP 8.1
apt install php8.1-fpm php8.1-mysql php8.1-mbstring php8.1-xml php8.1-bcmath php8.1-curl php8.1-zip php8.1-gd -y


ШАГ 5: Установка MySQL
apt install mysql-server -y


ШАГ 6: Установка Composer
curl -sS https://getcomposer.org/installer | php
mv composer.phar /usr/local/bin/composer
chmod +x /usr/local/bin/composer


ШАГ 7: Установка Git
apt install git -y


ШАГ 8: Создание базы данных
mysql -u root -p

В консоли MySQL выполните:
CREATE DATABASE mysite CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'mysite_user'@'localhost' IDENTIFIED BY 'strong_password';
GRANT ALL PRIVILEGES ON mysite.* TO 'mysite_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;


ШАГ 9: Клонирование проекта
cd /var/www
git clone https://github.com/lotostoi/mySite.git
cd mySite


ШАГ 10: Установка зависимостей
composer install --no-dev --optimize-autoloader


ШАГ 11: Настройка прав
chown -R www-data:www-data /var/www/mySite
chmod -R 755 /var/www/mySite
chmod -R 775 /var/www/mySite/storage
chmod -R 775 /var/www/mySite/bootstrap/cache


ШАГ 12: Настройка .env
cp .env.example .env
nano .env

Укажите в .env:
APP_NAME="Анна Волкова"
APP_ENV=production
APP_DEBUG=false
APP_URL=http://ваш_домен_или_ip

DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=mysite
DB_USERNAME=mysite_user
DB_PASSWORD=strong_password


ШАГ 13: Генерация ключа и миграции
php artisan key:generate
php artisan migrate --force
php artisan config:cache
php artisan route:cache
php artisan view:cache


ШАГ 14: Настройка Nginx
nano /etc/nginx/sites-available/mysite

Вставьте конфигурацию:

server {
    listen 80;
    listen [::]:80;
    server_name ваш_домен_или_ip;
    root /var/www/mySite/public;

    add_header X-Frame-Options "SAMEORIGIN";
    add_header X-Content-Type-Options "nosniff";

    index index.php;
    charset utf-8;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location = /favicon.ico { access_log off; log_not_found off; }
    location = /robots.txt  { access_log off; log_not_found off; }

    error_page 404 /index.php;

    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php8.1-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
        include fastcgi_params;
    }

    location ~ /\.(?!well-known).* {
        deny all;
    }
}


ШАГ 15: Активация сайта
ln -s /etc/nginx/sites-available/mysite /etc/nginx/sites-enabled/
rm /etc/nginx/sites-enabled/default
nginx -t
systemctl restart nginx


ШАГ 16: Установка SSL (опционально)
apt install certbot python3-certbot-nginx -y
certbot --nginx -d ваш_домен


ОБНОВЛЕНИЕ ПРОЕКТА НА СЕРВЕРЕ
------------------------------
cd /var/www/mySite
git pull origin master
composer install --no-dev --optimize-autoloader
php artisan migrate --force
php artisan config:cache
php artisan route:cache
php artisan view:cache


СТРУКТУРА ПРОЕКТА
-----------------
resources/views/welcome.blade.php - главная страница
routes/web.php - маршруты
public/ - публичная директория
.env - конфигурация


ССЫЛКИ
------
GitHub: https://github.com/lotostoi/mySite
Laravel: https://laravel.com/docs
